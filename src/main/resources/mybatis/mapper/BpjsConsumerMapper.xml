<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rsmurniteguh.bpjs.bpjsservice.repository.BpjsConsumerRepository">

    <insert id="insert" useGeneratedKeys="true" keyProperty="bpjsconsumer_id" keyColumn="bpjsconsumer_id" parameterType="BpjsConsumer">
        INSERT INTO bpjsconsumer
        (
            consumer_id
            ,consumer_secret
            ,created_by
            ,created_datetime
            ,defunct_ind
            ,entity_code
        )
        VALUES 
        (
            #{consumer_id}
            ,#{consumer_secret}
            ,#{created_by}
            ,current_timestamp
            ,'N'
            ,#{entity_code}
        )
    </insert>

    <update id="update" parameterType="BpjsConsumer">
        UPDATE bpjsconsumer 
        <set>
            consumer_id = #{consumer_id},
            consumer_secret = #{consumer_secret},
            <if test="updated_by">
                updated_by = #{updated_by},
            </if>
            last_updated_datetime = current_timestamp
        </set> 
        <where>
            bpjsconsumer_id = #{bpjsconsumer_id}
        </where>
    </update>

    <select id="getByEntityCode" resultType="BpjsConsumer">
        SELECT * FROM bpjsconsumer WHERE entity_code = #{entity_code} AND defunct_ind = 'N'
    </select>
</mapper>